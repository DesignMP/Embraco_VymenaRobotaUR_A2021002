define(["require", "exports", "../userInteractionController", "../../ChartBase"], function (require, exports, userInteractionController_1, ChartBase_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var ChartPanningStrategy = /** @class */ (function () {
        function ChartPanningStrategy(userInteractionController) {
            this.dragIsActive = false;
            this.currentDragChart = undefined;
            this.userInteractionController = userInteractionController;
        }
        ChartPanningStrategy.prototype.onMouseHover = function (chart, chartObjectTypeUnderMouse) {
            //TODO: remove direct chart access and move this to setCursor Method in Chart
            if (chartObjectTypeUnderMouse.chartObjectType == ChartBase_1.ChartObjectType.axis || chartObjectTypeUnderMouse.chartObjectType == ChartBase_1.ChartObjectType.chartSpace) {
                $(chart.cssParentContentId).css("cursor", "pointer");
                $(chart.cssParentContentId + "_canvas").css("cursor", "pointer");
            }
            else {
                $(chart.cssParentContentId).css("cursor", "default");
                $(chart.cssParentContentId + "_canvas").css("cursor", "default");
            }
        };
        ChartPanningStrategy.prototype.onClick = function (chart) {
        };
        ChartPanningStrategy.prototype.onMouseDown = function (chart, chartObjectTypeUnderMouse, mousePoint) {
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.togglePanning, chart, { boxZoomEnabled: false }));
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.toggleBoxZoom, chart, { panningEnabled: false }));
            if (chartObjectTypeUnderMouse.chartObjectType == ChartBase_1.ChartObjectType.cursor) {
                this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.togglePanning, chart, { boxZoomEnabled: false }));
                this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.toggleBoxZoom, chart, { panningEnabled: false }));
                this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.setCursorOnPointerPosition, chart, { cursorIndex: chartObjectTypeUnderMouse.args.cursorIndex, mousePoint: mousePoint }));
            }
            if (this.dragIsActive == false) {
                if (chartObjectTypeUnderMouse.args.axis != undefined) {
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.selectPanningAxes, chart, { zoomAxes: chartObjectTypeUnderMouse.args.axis }));
                }
                else {
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.selectPanningAxes, chart, { zoomAxes: undefined }));
                }
            }
            return chartObjectTypeUnderMouse;
        };
        ChartPanningStrategy.prototype.onDrag = function (chart, args) {
            if (this.currentDragChart == undefined || chart == this.currentDragChart) {
                if ((args.objectUnderMouse.chartObjectType != ChartBase_1.ChartObjectType.emptySpace && args.objectUnderMouse.chartObjectType != ChartBase_1.ChartObjectType.cursor) || this.dragIsActive == true) {
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.panChart, chart, { args: args }));
                    this.dragIsActive = true;
                    this.currentDragChart = chart;
                }
            }
            if (this.dragIsActive == false) {
                if (args.objectUnderMouse.args.axis != undefined) {
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.selectPanningAxes, chart, { zoomAxes: args.chartObjectUnderMouse.args.axis }));
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.toggleBoxZoom, chart, { boxZoomEnabled: false }));
                    this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.togglePanning, chart, { panningEnabled: false }));
                }
            }
        };
        ChartPanningStrategy.prototype.onDragEnd = function (chart) {
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.endCursorDrag, chart, {}));
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.toggleBoxZoom, chart, { boxZoomEnabled: false }));
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.togglePanning, chart, { panningEnabled: false }));
            this.dragIsActive = false;
            this.currentDragChart = undefined;
            this.userInteractionController.executeCommand(new userInteractionController_1.EventExecuteChartCommandArgs(this, userInteractionController_1.ChartCommandType.resetDragPosition, null, {}));
        };
        return ChartPanningStrategy;
    }());
    exports.ChartPanningStrategy = ChartPanningStrategy;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnRQYW5uaW5nU3RyYXRlZ3kuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvYXBwL3dpZGdldHMvY2hhcnRXaWRnZXQvdXNlckludGVyYWN0aW9uL3N0cmF0ZWdpZXMvY2hhcnRQYW5uaW5nU3RyYXRlZ3kudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBT0E7UUFPSSw4QkFBWSx5QkFBcUQ7WUFIakUsaUJBQVksR0FBRyxLQUFLLENBQUM7WUFDYixxQkFBZ0IsR0FBMEIsU0FBUyxDQUFDO1lBR3hELElBQUksQ0FBQyx5QkFBeUIsR0FBRyx5QkFBeUIsQ0FBQztRQUMvRCxDQUFDO1FBRUQsMkNBQVksR0FBWixVQUFhLEtBQWtCLEVBQUUseUJBQWlEO1lBQzlFLDZFQUE2RTtZQUM3RSxJQUFHLHlCQUF5QixDQUFDLGVBQWUsSUFBSSwyQkFBZSxDQUFDLElBQUksSUFBSSx5QkFBeUIsQ0FBQyxlQUFlLElBQUksMkJBQWUsQ0FBQyxVQUFVLEVBQUM7Z0JBQzVJLENBQUMsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUNyRCxDQUFDLENBQUMsS0FBSyxDQUFDLGtCQUFrQixHQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7YUFDbEU7aUJBQ0c7Z0JBQ0EsQ0FBQyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBQ3JELENBQUMsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLEdBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQzthQUNsRTtRQUNHLENBQUM7UUFFVCxzQ0FBTyxHQUFQLFVBQVEsS0FBa0I7UUFFMUIsQ0FBQztRQUVELDBDQUFXLEdBQVgsVUFB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QUFDLGFBQWEsRUFBRSxLQUFLLEVBQUUsRUFBQyxjQUFjLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ3JKLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1lBRTFCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUM7WUFDbEMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLGNBQWMsQ0FBQyxJQUFJLHdEQUE0QixDQUFDLElBQUksRUFBRSw0Q0FBZ0IsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4SSxDQUFDO1FBRUwsMkJBQUM7SUFBRCxDQUFDLEFBL0VELElBK0VDO0lBSU8sb0RBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUNoYXJ0SW50ZXJhY3Rpb25TdHJhdGVneSB9IGZyb20gXCIuL2NoYXJTdHJhdGVneUludGVyZmFjZVwiO1xyXG5pbXBvcnQgeyBDaGFydENvbW1hbmRUeXBlLCBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzIH0gZnJvbSBcIi4uL3VzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXJcIjtcclxuaW1wb3J0IHsgSVVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIgfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9jb250cm9sbGVySW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7IElUcmFjZUNoYXJ0IH0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXMvdHJhY2VDaGFydEludGVyZmFjZVwiO1xyXG5pbXBvcnQgeyBDaGFydE9iamVjdFR5cGUsIENoYXJ0T2JqZWN0SW5mb3JtYXRpb24gfSBmcm9tIFwiLi4vLi4vQ2hhcnRCYXNlXCI7XHJcbmltcG9ydCB7IElQb2ludCB9IGZyb20gXCIuLi8uLi8uLi8uLi9tb2RlbHMvY29tbW9uL2ludGVyZmFjZXMvcG9pbnRJbnRlcmZhY2VcIjtcclxuXHJcbmNsYXNzICBDaGFydFBhbm5pbmdTdHJhdGVneSBpbXBsZW1lbnRzIElDaGFydEludGVyYWN0aW9uU3RyYXRlZ3l7XHJcbiAgICBcclxuICAgIHByaXZhdGUgdXNlckludGVyYWN0aW9uQ29udHJvbGxlcjogSVVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXI7XHJcbiAgICBcclxuICAgIGRyYWdJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBjdXJyZW50RHJhZ0NoYXJ0OiBJVHJhY2VDaGFydHx1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IodXNlckludGVyYWN0aW9uQ29udHJvbGxlcjogSVVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIpIHtcclxuICAgICAgICB0aGlzLnVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIgPSB1c2VySW50ZXJhY3Rpb25Db250cm9sbGVyO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VIb3ZlcihjaGFydDogSVRyYWNlQ2hhcnQsIGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2U6IENoYXJ0T2JqZWN0SW5mb3JtYXRpb24pIHtcclxuICAgICAgICAvL1RPRE86IHJlbW92ZSBkaXJlY3QgY2hhcnQgYWNjZXNzIGFuZCBtb3ZlIHRoaXMgdG8gc2V0Q3Vyc29yIE1ldGhvZCBpbiBDaGFydFxyXG4gICAgICAgIGlmKGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2UuY2hhcnRPYmplY3RUeXBlID09IENoYXJ0T2JqZWN0VHlwZS5heGlzIHx8IGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2UuY2hhcnRPYmplY3RUeXBlID09IENoYXJ0T2JqZWN0VHlwZS5jaGFydFNwYWNlKXtcclxuICAgICAgICAgICAgJChjaGFydC5jc3NQYXJlbnRDb250ZW50SWQpLmNzcyhcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XHJcbiAgICAgICAgICAgICQoY2hhcnQuY3NzUGFyZW50Q29udGVudElkK1wiX2NhbnZhc1wiKS5jc3MoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAkKGNoYXJ0LmNzc1BhcmVudENvbnRlbnRJZCkuY3NzKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcclxuICAgICAgICAgICAgJChjaGFydC5jc3NQYXJlbnRDb250ZW50SWQrXCJfY2FudmFzXCIpLmNzcyhcImN1cnNvclwiLCBcImRlZmF1bHRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgIG9uQ2xpY2soY2hhcnQ6IElUcmFjZUNoYXJ0KSB7XHJcbiAgICAgIFxyXG4gICAgfSAgIFxyXG4gICAgXHJcbiAgICBvbk1vdXNlRG93bihjaGFydDogSVRyYWNlQ2hhcnQsIGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2U6IENoYXJ0T2JqZWN0SW5mb3JtYXRpb24sIG1vdXNlUG9pbnQ6IElQb2ludCk6IENoYXJ0T2JqZWN0SW5mb3JtYXRpb257XHJcbiAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUudG9nZ2xlUGFubmluZywgY2hhcnQsIHtib3hab29tRW5hYmxlZDogZmFsc2V9KSlcclxuICAgICAgICB0aGlzLnVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIuZXhlY3V0ZUNvbW1hbmQobmV3IEV2ZW50RXhlY3V0ZUNoYXJ0Q29tbWFuZEFyZ3ModGhpcywgQ2hhcnRDb21tYW5kVHlwZS50b2dnbGVCb3hab29tLCBjaGFydCwge3Bhbm5pbmdFbmFibGVkOiBmYWxzZX0pKVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2UuY2hhcnRPYmplY3RUeXBlID09IENoYXJ0T2JqZWN0VHlwZS5jdXJzb3IgKXtcclxuICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUudG9nZ2xlUGFubmluZywgY2hhcnQsIHtib3hab29tRW5hYmxlZDogZmFsc2V9KSlcclxuICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUudG9nZ2xlQm94Wm9vbSwgY2hhcnQsIHtwYW5uaW5nRW5hYmxlZDogZmFsc2V9KSlcclxuICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUuc2V0Q3Vyc29yT25Qb2ludGVyUG9zaXRpb24sIGNoYXJ0LCB7Y3Vyc29ySW5kZXg6IGNoYXJ0T2JqZWN0VHlwZVVuZGVyTW91c2UuYXJncy5jdXJzb3JJbmRleCwgbW91c2VQb2ludDogbW91c2VQb2ludH0pKVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuZHJhZ0lzQWN0aXZlID09IGZhbHNlKXtcclxuICAgICAgICAgICAgaWYoY2hhcnRPYmplY3RUeXBlVW5kZXJNb3VzZS5hcmdzLmF4aXMgIT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMudXNlckludGVyYWN0aW9uQ29udHJvbGxlci5leGVjdXRlQ29tbWFuZChuZXcgRXZlbnRFeGVjdXRlQ2hhcnRDb21tYW5kQXJncyh0aGlzLCBDaGFydENvbW1hbmRUeXBlLnNlbGVjdFBhbm5pbmdBeGVzLCBjaGFydCwge3pvb21BeGVzOiBjaGFydE9iamVjdFR5cGVVbmRlck1vdXNlLmFyZ3MuYXhpc30pKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIuZXhlY3V0ZUNvbW1hbmQobmV3IEV2ZW50RXhlY3V0ZUNoYXJ0Q29tbWFuZEFyZ3ModGhpcywgQ2hhcnRDb21tYW5kVHlwZS5zZWxlY3RQYW5uaW5nQXhlcywgY2hhcnQsIHt6b29tQXhlczogdW5kZWZpbmVkfSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjaGFydE9iamVjdFR5cGVVbmRlck1vdXNlO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgb25EcmFnKGNoYXJ0OiBJVHJhY2VDaGFydCwgYXJncykge1xyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudERyYWdDaGFydCA9PSB1bmRlZmluZWQgfHxjaGFydCA9PSB0aGlzLmN1cnJlbnREcmFnQ2hhcnQpe1xyXG4gICAgICAgICAgICBpZigoYXJncy5vYmplY3RVbmRlck1vdXNlLmNoYXJ0T2JqZWN0VHlwZSAhPSBDaGFydE9iamVjdFR5cGUuZW1wdHlTcGFjZSAmJiBhcmdzLm9iamVjdFVuZGVyTW91c2UuY2hhcnRPYmplY3RUeXBlICE9IENoYXJ0T2JqZWN0VHlwZS5jdXJzb3IpIHx8IHRoaXMuZHJhZ0lzQWN0aXZlID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUucGFuQ2hhcnQsIGNoYXJ0LCB7YXJnczogYXJnc30pKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnSXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RHJhZ0NoYXJ0ID0gY2hhcnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuZHJhZ0lzQWN0aXZlID09IGZhbHNlKXtcclxuICAgICAgICAgICAgaWYoYXJncy5vYmplY3RVbmRlck1vdXNlLmFyZ3MuYXhpcyAhPSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUuc2VsZWN0UGFubmluZ0F4ZXMsIGNoYXJ0LCB7em9vbUF4ZXM6IGFyZ3MuY2hhcnRPYmplY3RVbmRlck1vdXNlLmFyZ3MuYXhpc30pKVxyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUudG9nZ2xlQm94Wm9vbSwgY2hhcnQsIHtib3hab29tRW5hYmxlZDogZmFsc2V9KSlcclxuICAgICAgICAgICAgICAgIHRoaXMudXNlckludGVyYWN0aW9uQ29udHJvbGxlci5leGVjdXRlQ29tbWFuZChuZXcgRXZlbnRFeGVjdXRlQ2hhcnRDb21tYW5kQXJncyh0aGlzLCBDaGFydENvbW1hbmRUeXBlLnRvZ2dsZVBhbm5pbmcsIGNoYXJ0LCB7cGFubmluZ0VuYWJsZWQ6IGZhbHNlfSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25EcmFnRW5kKGNoYXJ0OiBJVHJhY2VDaGFydCl7XHJcbiAgICAgICAgdGhpcy51c2VySW50ZXJhY3Rpb25Db250cm9sbGVyLmV4ZWN1dGVDb21tYW5kKG5ldyBFdmVudEV4ZWN1dGVDaGFydENvbW1hbmRBcmdzKHRoaXMsIENoYXJ0Q29tbWFuZFR5cGUuZW5kQ3Vyc29yRHJhZywgY2hhcnQsIHt9KSlcclxuICAgICAgICB0aGlzLnVzZXJJbnRlcmFjdGlvbkNvbnRyb2xsZXIuZXhlY3V0ZUNvbW1hbmQobmV3IEV2ZW50RXhlY3V0ZUNoYXJ0Q29tbWFuZEFyZ3ModGhpcywgQ2hhcnRDb21tYW5kVHlwZS50b2dnbGVCb3hab29tLCBjaGFydCwge2JveFpvb21FbmFibGVkOiBmYWxzZX0pKVxyXG4gICAgICAgIHRoaXMudXNlckludGVyYWN0aW9uQ29udHJvbGxlci5leGVjdXRlQ29tbWFuZChuZXcgRXZlbnRFeGVjdXRlQ2hhcnRDb21tYW5kQXJncyh0aGlzLCBDaGFydENvbW1hbmRUeXBlLnRvZ2dsZVBhbm5pbmcsIGNoYXJ0LCB7cGFubmluZ0VuYWJsZWQ6IGZhbHNlfSkpXHJcbiAgICAgICAgdGhpcy5kcmFnSXNBY3RpdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5jdXJyZW50RHJhZ0NoYXJ0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMudXNlckludGVyYWN0aW9uQ29udHJvbGxlci5leGVjdXRlQ29tbWFuZChuZXcgRXZlbnRFeGVjdXRlQ2hhcnRDb21tYW5kQXJncyh0aGlzLCBDaGFydENvbW1hbmRUeXBlLnJlc2V0RHJhZ1Bvc2l0aW9uLCBudWxsICx7fSkpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcblxyXG5leHBvcnQge0NoYXJ0UGFubmluZ1N0cmF0ZWd5fSJdfQ==